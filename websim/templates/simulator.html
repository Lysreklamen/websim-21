<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>UKA21 WebSim</title>
    <meta name='viewport'
        content='width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no' />
    <link href="static/css/bootstrap.min.css" rel="stylesheet">
    <style>
        html,
        body {
            height: 100%;
        }

        header {
            position: fixed;
            width: 100%;
            top: 0;
            padding: 1rem 0;
        }

        #content {
            padding-bottom: 10em;
            height: 100%;
            width: 100%;
        }

        footer {
            position: fixed;
            height: 10em;
            width: 100%;
            bottom: 0;
            line-height: 3rem;
        }
    </style>
</head>

<body>
    <div id="content">
        <canvas id="application" style="height: 100%; width: 100%;"></canvas>
    </div>
    <footer>
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#pgms" type="button">PGMs</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#development"
                    type="button">Development</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#contact" type="button">Contact</button>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane fade show active" id="pgms">
                PGM list here
            </div>
            <div class="tab-pane fade" id="development">
                WebSocket connection
            </div>
            <div class="tab-pane fade" id="contact">
                Test123
            </div>
        </div>
    </footer>

    <script src="static/js/bootstrap.js"></script>
    <script type="module">
        import { init, loadSign, pushFrame } from './static/js/sim.js';
        import { PlayPGM } from './static/js/pgm.js';

        function startup() {
            const url = new URL(window.location.href)
            const sign_name = url.searchParams.get("sign");
            if (sign_name == null) {
                alert("Sign name not provided!")
                return;
            }
            const api_base = "api/signs/" + sign_name;

            // create a PlayCanvas application
            const canvas = document.getElementById('application');
            init(canvas);
            loadSign(api_base);

            function htmlToElement(html) {
                var template = document.createElement('template');
                html = html.trim(); // Never return a text node of whitespace as the result
                template.innerHTML = html;
                return template.content.firstChild;
            }

            // fetch(api_base + "/pgms.json").then(response => response.json()).then(data => {
            //     const elem_sequences = document.getElementById("pgm-sequences");
            //     elem_sequences.innerHTML = "";

            //     for (const pgm_path of data) {
            //         const elem = htmlToElement('<li class="nav-item"><a class="nav-link pgmplay" href="#">' + pgm_path + '</a></li>');
            //         elem.addEventListener('click', event => {
            //             event.preventDefault();
            //             PlayPGM(api_base + "/pgms/" + pgm_path, pushFrame);
            //         });
            //         elem_sequences.appendChild(elem);
            //     }

            // });
        };

        startup();


    </script>
</body>

</html>